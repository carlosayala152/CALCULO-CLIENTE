<!DOCTYPE html>
<html lang="pt-br">
<head>
<meta charset="UTF-8">
<title>ADMIN — SISTEMA DE CORTE PRO</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:Segoe UI,Arial,sans-serif;
  background:#0f172a;
  color:#fff;
}
.topo{
  background:#020617;
  padding:14px;
  text-align:center;
  font-size:20px;
  font-weight:bold;
}
.topo small{
  display:block;
  font-size:13px;
  color:#94a3b8;
}
.container{
  max-width:1100px;
  margin:auto;
  padding:20px;
}
.card{
  background:#020617;
  padding:20px;
  border-radius:12px;
  margin-bottom:20px;
}
input,select,button{
  width:100%;
  padding:10px;
  margin-top:8px;
  border-radius:8px;
  border:none;
  font-size:15px;
}
button.primary{
  background:#10b981;
  color:#fff;
  font-weight:bold;
  cursor:pointer;
}
button.secondary{
  background:#64748b;
  color:#fff;
}
table{
  width:100%;
  border-collapse:collapse;
  margin-top:15px;
}
th,td{
  padding:10px;
  border:1px solid #1e293b;
  text-align:center;
}
th{
  background:#0f172a;
}
.badge-on{color:#22c55e;font-weight:bold}
.badge-off{color:#ef4444;font-weight:bold}
.actions button{margin:2px;padding:6px 8px;font-size:13px}
.msg{color:#f87171;margin-top:10px;font-size:14px}
.hidden{display:none}
</style>
</head>

<body>

<div class="topo">
  SISTEMA DE CORTE PRO
  <small>Admin • by Carlos Daniel / DANI</small>
</div>

<div class="container">

  <!-- LOGIN -->
  <div class="card" id="loginBox">
    <h3>Login Admin</h3>
    <input type="password" id="adminPass" placeholder="Senha admin">
    <button class="primary" onclick="login()">Entrar</button>
    <div id="loginMsg" class="msg"></div>
  </div>

  <!-- PAINEL -->
  <div class="hidden" id="panel">

    <!-- FORMULÁRIO -->
    <div class="card">
      <h3 id="formTitle">Criar Cliente</h3>

      <select id="status">
        <option value="ON">ON</option>
        <option value="OFF">OFF</option>
      </select>

      <input id="senha" placeholder="Senha do cliente">

      <input id="validade" type="date">

      <input id="cliente" placeholder="Nome do cliente">

      <select id="plano">
        <option>MENSAL</option>
        <option>TRIMESTRAL</option>
        <option>ANUAL</option>
      </select>

      <input type="hidden" id="linha">

      <button class="primary" onclick="salvar()">Salvar</button>
      <button class="secondary" onclick="limpar()">Cancelar</button>

      <div id="formMsg" class="msg"></div>
    </div>

    <!-- TABELA DE CLIENTES -->
    <div class="card">
      <h3>Clientes</h3>
      <table>
        <thead>
          <tr>
            <th>Status</th><th>Cliente</th><th>Senha</th><th>Validade</th><th>Plano</th><th>Ações</th>
          </tr>
        </thead>
        <tbody id="lista">
          <tr><td colspan="6">Carregando...</td></tr>
        </tbody>
      </table>
    </div>

  </div>
</div>

<script>
// CONFIG
const ADMIN_PASS = "Amor2403";
const SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxQcWaSSrpbMC5FYpUnSLKdSQ1lMC-hlZtwt5I_9ko1OonFTDpjwofx-si2ujC8sDDGmw/exec";

// LOGIN
function login(){
  if(adminPass.value !== ADMIN_PASS){
    loginMsg.innerText = "Senha incorreta";
    return;
  }
  loginBox.classList.add("hidden");
  panel.classList.remove("hidden");
  carregarLista();
}

// CHAMA O SCRIPT
async function chamar(params){
  const url = SCRIPT_URL + "?" + new URLSearchParams(params).toString();
  const res = await fetch(url);
  return res.json();
}

// LISTAR CLIENTES
async function carregarLista(){
  const dados = await chamar({acao:"listar"});
  const tbody = document.getElementById("lista");
  tbody.innerHTML = "";

  if(!Array.isArray(dados) || dados.length === 0){
    tbody.innerHTML = "<tr><td colspan='6'>Nenhum cliente</td></tr>";
    return;
  }

  dados.forEach((c,i) => {
    tbody.innerHTML += `
      <tr>
        <td class="${c.status==="ON"?"badge-on":"badge-off"}">${c.status}</td>
        <td>${c.cliente}</td>
        <td>${c.senha}</td>
        <td>${c.validade}</td>
        <td>${c.plano}</td>
        <td class="actions">
          <button onclick="editar(${i})">Editar</button>
          <button onclick="alternar(${i})">${c.status==="ON"?"OFF":"ON"}</button>
        </td>
      </tr>`;
  });
}

// LIMPAR FORMULÁRIO
function limpar(){
  status.value="ON";
  senha.value="";
  validade.value="";
  cliente.value="";
  plano.value="MENSAL";
  linha.value="";
  formTitle.innerText="Criar Cliente";
  formMsg.innerText="";
}

// SALVAR (CRIAR / EDITAR)
async function salvar(){
  if(!senha.value || !validade.value || !cliente.value){
    formMsg.innerText = "Preencha todos os campos";
    return;
  }

  const params = {
    acao:"salvar",
    status: status.value,
    senha: senha.value,
    validade: validade.value,
    cliente: cliente.value,
    plano: plano.value
  };

  if(linha.value){
    params.linha = linha.value;
    params.acao = "atualizar";
  }

  await chamar(params);
  limpar();
  carregarLista();
}

// EDITAR
async function editar(i){
  const dados = await chamar({acao:"listar"});
  const item = dados[i];

  status.value = item.status;
  senha.value   = item.senha;
  validade.value= item.validade;
  cliente.value = item.cliente;
  plano.value   = item.plano;
  linha.value   = i;
  formTitle.innerText = "Editar Cliente";
}

// ALTERNAR ON/OFF
async function alternar(i){
  const dados = await chamar({acao:"listar"});
  const atual = dados[i];
  await chamar({
    acao:"salvar",
    status: atual.status==="ON"?"OFF":"ON",
    senha: atual.senha,
    validade: atual.validade,
    cliente: atual.cliente,
    plano: atual.plano
  });
  carregarLista();
}
</script>

</body>
</html>
